(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["addFood"],{"693e":function(e,t,o){"use strict";var a=o("92c3"),r=o.n(a);r.a},"92c3":function(e,t,o){},ae65:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"add-food-wrapper"},[o("div",{staticClass:"add-food-category-wrapper"},[o("p",{staticClass:"mb20"},[e._v("选择食品种类")]),o("el-form",{ref:"categoryForm",staticClass:"form",attrs:{"label-width":"110px",model:e.categoryForm,rules:e.ruleAddFoodCategory}},[o("el-row",{staticClass:"category-select"},[o("el-form-item",{attrs:{label:"食品种类"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择食品种类"},on:{change:e.selectFoodCategory},model:{value:e.categoryForm.categorySelect,callback:function(t){e.$set(e.categoryForm,"categorySelect",t)},expression:"categoryForm.categorySelect"}},e._l(e.categoryForm.categoryList,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),o("el-row",{staticClass:"add_category_row",class:e.showAddCategory?"showEdit":""},[o("div",{staticClass:"add_category"},[o("el-form-item",{attrs:{label:"食品种类",prop:"name"}},[o("el-input",{model:{value:e.categoryForm.name,callback:function(t){e.$set(e.categoryForm,"name",t)},expression:"categoryForm.name"}})],1),o("el-form-item",{attrs:{label:"种类描述",prop:"description"}},[o("el-input",{model:{value:e.categoryForm.description,callback:function(t){e.$set(e.categoryForm,"description",t)},expression:"categoryForm.description"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitcategoryForm("categoryForm")}}},[e._v("提交")])],1)],1)]),o("div",{staticClass:"add_category_button pt10",on:{click:function(t){e.showAddCategory=!e.showAddCategory}}},[e.showAddCategory?o("i",{staticClass:"el-icon-caret-top edit_icon"}):o("i",{staticClass:"el-icon-caret-bottom edit_icon",attrs:{slot:"icon"},slot:"icon"}),o("span",[e._v("添加食品种类")])])],1),o("p",{staticClass:"mb20 mt20"},[e._v("添加食品")]),o("el-form",{ref:"foodForm",staticClass:"form food_form add_category",attrs:{"label-width":"110px",model:e.foodDetail,rules:e.ruleAddFood}},[o("el-form-item",{attrs:{label:"食品名称",prop:"name"}},[o("el-input",{model:{value:e.foodDetail.name,callback:function(t){e.$set(e.foodDetail,"name",t)},expression:"foodDetail.name"}})],1),o("el-form-item",{attrs:{label:"食品介绍",prop:"introduce"}},[o("el-input",{model:{value:e.foodDetail.introduce,callback:function(t){e.$set(e.foodDetail,"introduce",t)},expression:"foodDetail.introduce"}})],1),o("el-form-item",{attrs:{label:"上传食品图片",prop:"image"}},[o("el-upload",{staticClass:"avatar-uploader textl",attrs:{action:"/api/food/updateFoodImg","show-file-list":!1,"on-success":e.updateAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.foodDetail.image?o("img",{staticClass:"avatar",attrs:{src:e.IMAGESDOMAIN+e.foodDetail.image}}):o("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),o("el-form-item",{staticClass:"textl",attrs:{label:"* 价格",prop:"send_price"}},[o("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.foodDetail.price,callback:function(t){e.$set(e.foodDetail,"price",t)},expression:"foodDetail.price"}})],1),o("el-form-item",{staticClass:"textl",attrs:{label:"* 包装费",prop:"send_price"}},[o("el-input-number",{attrs:{"controls-position":"right",min:1},model:{value:e.foodDetail.package_price,callback:function(t){e.$set(e.foodDetail,"package_price",t)},expression:"foodDetail.package_price"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFoodForm("foodForm")}}},[e._v(e._s(e.btnText))]),o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.resetFoodForm("foodForm")}}},[e._v("重置")])],1)],1)],1),o("div",{staticClass:"food-detail-wrapper"})])},r=[],i=(o("cc57"),o("163d"),o("740c")),s={mixins:[i["c"]],data:function(){return{categoryForm:{categoryList:[],categorySelect:"",name:"",description:""},foodDetail:{name:"",introduce:"",category:0,image:"",shop_id:"",price:"",package_price:""},activeNames:[],showAddCategory:!1,showTest:{},pid:this.$route.query.pid,foodId:this.$route.query.foodId,editFlag:!1,btnText:"立即添加",ruleAddFoodCategory:{name:[{required:!0,message:"请输入商铺名称",trigger:"change"}],description:[{required:!0,message:"请输入商铺名称",trigger:"change"}]},ruleAddFood:{name:[{required:!0,message:"请输入食品名称",trigger:"change"}],introduce:[{required:!0,message:"请输入食品介绍",trigger:"change"}],image:[{required:!0,message:"请上传食品",trigger:"change"}],shop_id:[{required:!0,message:"商铺id有误",trigger:"change"}],price:[{required:!0,message:"请输入食品价格",trigger:"change"}],package_price:[{required:!0,message:"请输入食品包装费",trigger:"change"}]}}},created:function(){var e=this;if(this.pid){var t={pid:this.pid};this._getCategoryByPid(t).then((function(){e.isEdit()}))}else this.$message.error("请选择商铺"),this.$router.push({path:"./merchantsList.html"})},methods:{isEdit:function(){this.$route.query.isEdit&&"1"==this.$route.query.isEdit&&(this.editFlag=!0,this.btnText="立即更新",this._getFoodById())},_getFoodById:function(){var e=this,t={foodId:this.$route.query.foodId};this.Service.getFoodById(t).then((function(t){200===t.status?(e.foodDetail=t.data[0],e.categoryForm.categorySelect=Number(e.foodDetail.category)):e.$message.success(t.message)}))},selectFoodCategory:function(e){this.categoryForm.categorySelect=e},submitcategoryForm:function(e){var t=this;this.$refs[e].validate((function(e){e&&t._createFoodCategory()}))},_createFoodCategory:function(){var e=this,t={pid:this.pid,name:this.categoryForm.name,desc:this.categoryForm.description};this.Service.createFoodCategory(t).then((function(t){200===t.status?(e.$message.success(t.message),e.$refs["categoryForm"].resetFields(),e._getCategoryByPid()):e.$message.error(t.message)}))},submitFoodForm:function(e){var t=this;this.foodDetail.shop_id=this.pid,this.foodDetail.category=this.categoryForm.categorySelect,0!==Number(this.foodDetail.category)?this.$refs[e].validate((function(e){e&&(t.editFlag?t._updateFood():t._createdFood())})):this.$message.error("请选择食品分类")},_updateFood:function(){var e=this;this.Service.updatedFood(this.foodDetail).then((function(t){200===t.status&&(e.$message.success(t.message),e.$router.go(-1))}))},_createdFood:function(){var e=this;this.Service.createdFood(this.foodDetail).then((function(t){200===t.status&&(e.$message.success(t.message),e.resetFoodForm("foodForm"))}))},beforeAvatarUpload:function(e){this.checkPic(e,200)},updateAvatarSuccess:function(e){200===e.status?this.foodDetail[e.data.attribute]=e.data.filename:this.$message.error(e.message)},_getCategoryByPid:function(){var e=this,t={pid:this.pid};return this.Service.getCategoryByPid(t).then((function(t){e.categoryForm.categoryList=t.data}))},resetFoodForm:function(e){this.$refs[e].resetFields()}}},c=s,d=(o("693e"),o("5511")),n=Object(d["a"])(c,a,r,!1,null,null,null);t["default"]=n.exports},cc57:function(e,t,o){var a=o("064e").f,r=Function.prototype,i=/^\s*function ([^ (]*)/,s="name";s in r||o("149f")&&a(r,s,{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(e){return""}}})}}]);